<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ì„¸ë„· (Senet) Â· ë©€í‹°í”Œë ˆì´ì–´</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <div class="main-container">
        <div class="welcome-section">
          <h1>ì„¸ë„· (Senet)</h1>
          <p>ê³ ëŒ€ ì´ì§‘íŠ¸ì˜ ì „ëµ ë³´ë“œê²Œì„ì„ ì˜¨ë¼ì¸ì—ì„œ ì¦ê²¨ë³´ì„¸ìš”</p>
        </div>

        <div class="game-options">
          <div class="option-card" onclick="showCreateRoom()">
            <h3>ğŸ†• ìƒˆ ë°© ë§Œë“¤ê¸°</h3>
            <p>ìƒˆë¡œìš´ ê²Œì„ ë°©ì„ ìƒì„±í•˜ê³  ì¹œêµ¬ë¥¼ ì´ˆëŒ€í•˜ì„¸ìš”</p>
          </div>

          <div class="option-card" onclick="showJoinRoom()">
            <h3>ğŸ”— ë°© ì°¸ê°€í•˜ê¸°</h3>
            <p>ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì—¬ ê¸°ì¡´ ë°©ì— ì°¸ê°€í•˜ì„¸ìš”</p>
          </div>

          <div class="option-card" onclick="showPublicRooms()">
            <h3>ğŸŒ ê³µê°œ ë°© ë³´ê¸°</h3>
            <p>ë‹¤ë¥¸ í”Œë ˆì´ì–´ë“¤ì´ ë§Œë“  ê³µê°œ ë°©ì„ ì°¾ì•„ë³´ì„¸ìš”</p>
          </div>
        </div>

        <!-- ë°© ìƒì„± ì„¹ì…˜ -->
        <div id="create-room-section" class="room-section hidden">
          <h3>ìƒˆ ë°© ë§Œë“¤ê¸°</h3>
          <form class="room-form" id="create-room-form">
            <div class="form-group">
              <label for="room-name">ë°© ì´ë¦„</label>
              <input
                type="text"
                id="room-name"
                placeholder="ì˜ˆ: ì¹œêµ¬ë“¤ê³¼ ì„¸ë„·"
                required
              />
            </div>
            <div class="form-group">
              <label for="player-name">í”Œë ˆì´ì–´ ì´ë¦„</label>
              <input
                type="text"
                id="player-name"
                placeholder="ë‹¹ì‹ ì˜ ì´ë¦„"
                required
              />
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="is-public" checked />
                ê³µê°œ ë°©ìœ¼ë¡œ ì„¤ì •
              </label>
            </div>
            <button type="submit" class="btn">ë°© ë§Œë“¤ê¸°</button>
          </form>
        </div>

        <!-- ë°© ì°¸ê°€ ì„¹ì…˜ -->
        <div id="join-room-section" class="room-section hidden">
          <h3>ë°© ì°¸ê°€í•˜ê¸°</h3>
          <form class="room-form" id="join-room-form">
            <div class="form-group">
              <label for="room-code">ë°© ì½”ë“œ</label>
              <input
                type="text"
                id="room-code"
                placeholder="ì˜ˆ: ABC123"
                required
              />
            </div>
            <div class="form-group">
              <label for="join-player-name">í”Œë ˆì´ì–´ ì´ë¦„</label>
              <input
                type="text"
                id="join-player-name"
                placeholder="ë‹¹ì‹ ì˜ ì´ë¦„"
                required
              />
            </div>
            <button type="submit" class="btn">ë°© ì°¸ê°€</button>
          </form>
        </div>

        <!-- ê³µê°œ ë°© ëª©ë¡ ì„¹ì…˜ -->
        <div id="public-rooms-section" class="room-section hidden">
          <h3>ê³µê°œ ë°© ëª©ë¡</h3>
          <div id="rooms-list" class="room-list">
            <div class="loading">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>

        <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ -->
        <div id="message-area"></div>

        <!-- ë’¤ë¡œê°€ê¸° ë²„íŠ¼ -->
        <div
          id="back-section"
          class="hidden"
          style="text-align: center; margin-top: 20px"
        >
          <button class="btn ghost" onclick="showMainMenu()">
            â† ë©”ì¸ ë©”ë‰´ë¡œ
          </button>
        </div>
      </div>
    </div>

    <script>
      // ë©”ì¸ ë©”ë‰´ í‘œì‹œ
      function showMainMenu() {
        document.querySelector(".game-options").classList.remove("hidden");
        document.getElementById("create-room-section").classList.add("hidden");
        document.getElementById("join-room-section").classList.add("hidden");
        document.getElementById("public-rooms-section").classList.add("hidden");
        document.getElementById("back-section").classList.add("hidden");
        clearMessages();
      }

      // ë°© ìƒì„± í™”ë©´ í‘œì‹œ
      function showCreateRoom() {
        document.querySelector(".game-options").classList.add("hidden");
        document
          .getElementById("create-room-section")
          .classList.remove("hidden");
        document.getElementById("back-section").classList.remove("hidden");
        clearMessages();
      }

      // ë°© ì°¸ê°€ í™”ë©´ í‘œì‹œ
      function showJoinRoom() {
        document.querySelector(".game-options").classList.add("hidden");
        document.getElementById("join-room-section").classList.remove("hidden");
        document.getElementById("back-section").classList.remove("hidden");
        clearMessages();
      }

      // ê³µê°œ ë°© ëª©ë¡ í‘œì‹œ
      function showPublicRooms() {
        document.querySelector(".game-options").classList.add("hidden");
        document
          .getElementById("public-rooms-section")
          .classList.remove("hidden");
        document.getElementById("back-section").classList.remove("hidden");
        clearMessages();
        loadPublicRooms();
      }

      // ë©”ì‹œì§€ í‘œì‹œ
      function showMessage(message, type = "info") {
        const messageArea = document.getElementById("message-area");
        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;
        messageArea.appendChild(messageDiv);

        // 5ì´ˆ í›„ ìë™ ì œê±°
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.remove();
          }
        }, 5000);
      }

      // ë©”ì‹œì§€ ì´ˆê¸°í™”
      function clearMessages() {
        document.getElementById("message-area").innerHTML = "";
      }

      // ê³µê°œ ë°© ëª©ë¡ ë¡œë“œ
      function loadPublicRooms() {
        const roomsList = document.getElementById("rooms-list");
        roomsList.innerHTML =
          '<div class="loading">ë°© ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

        // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ ë°© ëª©ë¡ì„ ê°€ì ¸ì˜´
        setTimeout(() => {
          const mockRooms = [
            {
              id: "ABC123",
              name: "ì¹œêµ¬ë“¤ê³¼ ì„¸ë„·",
              players: 2,
              maxPlayers: 4,
              status: "ëŒ€ê¸° ì¤‘",
            },
            {
              id: "DEF456",
              name: "ì„¸ë„· ë§ˆìŠ¤í„°",
              players: 3,
              maxPlayers: 4,
              status: "ê²Œì„ ì¤‘",
            },
            {
              id: "GHI789",
              name: "ì´ˆë³´ì í™˜ì˜",
              players: 1,
              maxPlayers: 4,
              status: "ëŒ€ê¸° ì¤‘",
            },
          ];

          roomsList.innerHTML = "";
          mockRooms.forEach((room) => {
            const roomItem = createRoomItem(room);
            roomsList.appendChild(roomItem);
          });
        }, 1000);
      }

      // ë°© ì•„ì´í…œ ìƒì„±
      function createRoomItem(room) {
        const roomItem = document.createElement("div");
        roomItem.className = "room-item";

        const playerDots = Array.from(
          { length: room.maxPlayers },
          (_, i) =>
            `<div class="player-dot ${i < room.players ? "active" : ""}"></div>`
        ).join("");

        roomItem.innerHTML = `
          <div class="room-info">
            <div class="room-name">${room.name}</div>
            <div class="room-status">${room.status} â€¢ ${room.id}</div>
          </div>
          <div class="player-count">
            <span>${room.players}/${room.maxPlayers}</span>
            <div class="player-dots">${playerDots}</div>
          </div>
          <button class="btn-join" ${
            room.status === "ê²Œì„ ì¤‘" ? "disabled" : ""
          } onclick="joinRoom('${room.id}')">
            ${room.status === "ê²Œì„ ì¤‘" ? "ê²Œì„ ì¤‘" : "ì°¸ê°€"}
          </button>
        `;

        return roomItem;
      }

      // ë°© ì°¸ê°€
      function joinRoom(roomCode) {
        const playerName = prompt("í”Œë ˆì´ì–´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");
        if (playerName) {
          showMessage(`ë°© ${roomCode}ì— ì°¸ê°€ ì¤‘...`, "success");
          // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì— ì°¸ê°€ ìš”ì²­ì„ ë³´ëƒ„
          setTimeout(() => {
            window.location.href = `index.html?room=${roomCode}&player=${encodeURIComponent(
              playerName
            )}`;
          }, 1000);
        }
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      document.addEventListener("DOMContentLoaded", function () {
        // ë°© ìƒì„± í¼ ì œì¶œ
        document
          .getElementById("create-room-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            const roomName = document.getElementById("room-name").value;
            const playerName = document.getElementById("player-name").value;
            const isPublic = document.getElementById("is-public").checked;

            showMessage("ë°©ì„ ìƒì„±í•˜ëŠ” ì¤‘...", "success");

            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì— ë°© ìƒì„± ìš”ì²­ì„ ë³´ëƒ„
            setTimeout(() => {
              const roomCode = Math.random()
                .toString(36)
                .substr(2, 6)
                .toUpperCase();
              showMessage(
                `ë°©ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ë°© ì½”ë“œ: ${roomCode}`,
                "success"
              );
              setTimeout(() => {
                window.location.href = `index.html?room=${roomCode}&player=${encodeURIComponent(
                  playerName
                )}`;
              }, 2000);
            }, 1000);
          });

        // ë°© ì°¸ê°€ í¼ ì œì¶œ
        document
          .getElementById("join-room-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            const roomCode = document.getElementById("room-code").value;
            const playerName =
              document.getElementById("join-player-name").value;

            showMessage(`ë°© ${roomCode}ì— ì°¸ê°€ ì¤‘...`, "success");

            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì— ì°¸ê°€ ìš”ì²­ì„ ë³´ëƒ„
            setTimeout(() => {
              window.location.href = `index.html?room=${roomCode}&player=${encodeURIComponent(
                playerName
              )}`;
            }, 1000);
          });
      });
    </script>
  </body>
</html>
