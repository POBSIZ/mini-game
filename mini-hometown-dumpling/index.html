<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë¯¸ì‹ê°€ ë ˆì‹œí”¼ ì‹œë„ˆì§€ ê²Œì„ v2</title>
    <style>
      :root {
        --bg: #0f1020;
        --panel: #17192f;
        --accent: #8ef6ff;
        --accent2: #ffd166;
        --good: #4ade80;
        --bad: #f87171;
        --text: #e8eaf6;
        --muted: #aab0d5;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Pretendard", ui-sans-serif, system-ui, -apple-system,
          Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif;
        color: var(--text);
        background: radial-gradient(
          1200px 700px at 20% 10%,
          #18203a 0%,
          var(--bg) 55%
        );
        min-height: 100dvh;
        overflow-x: hidden;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 20px;
      }
      .story {
        position: relative;
        height: 64dvh;
        border-radius: 20px;
        background: radial-gradient(
            800px 400px at 80% -10%,
            rgba(255, 255, 255, 0.08),
            transparent 60%
          ),
          linear-gradient(180deg, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.2));
        overflow: hidden;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.35);
      }
      .kitchen-bg {
        position: absolute;
        inset: 0;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800"><defs><linearGradient id="g" x1="0" x2="0" y1="0" y2="1"><stop stop-color="%231a2140"/><stop offset="1" stop-color="%230f1020"/></linearGradient></defs><rect width="100%" height="100%" fill="url(%23g)"/><g opacity="0.18" stroke="%23a8b3ff" stroke-width="2" fill="none"><path d="M0 620 C 200 600, 400 580, 1200 620"/><path d="M-100 660 C 200 640, 500 630, 1300 660"/><path d="M-80 700 C 220 680, 520 690, 1280 720"/></g></svg>')
          center/cover no-repeat;
        filter: contrast(110%) saturate(110%);
      }
      .chef,
      .critic {
        position: absolute;
        bottom: 20px;
        width: 160px;
        aspect-ratio: 1/1;
        border-radius: 18px;
        background: var(--panel);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 70px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
      }
      .chef {
        left: 20px;
        animation: floatY 3.5s ease-in-out infinite;
      }
      .critic {
        right: -220px;
        animation: arrive 3.2s 1.2s ease forwards,
          floatY 4s 4.6s ease-in-out infinite;
      }
      @keyframes arrive {
        to {
          right: 20px;
        }
      }
      @keyframes floatY {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }
      .title {
        position: absolute;
        left: 24px;
        top: 24px;
        font-size: 28px;
        letter-spacing: 0.3px;
        color: var(--accent);
        text-shadow: 0 2px 0 rgba(0, 0, 0, 0.35);
      }
      .speech {
        position: absolute;
        right: 220px;
        bottom: 140px;
        max-width: 420px;
        padding: 14px 16px;
        background: #1f2342;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        filter: drop-shadow(0 10px 18px rgba(0, 0, 0, 0.35));
        opacity: 0;
        transform: translateY(10px);
        animation: popIn 0.9s 2.2s ease forwards;
      }
      .speech:after {
        content: "";
        position: absolute;
        right: -10px;
        bottom: 18px;
        width: 0;
        height: 0;
        border-left: 10px solid #1f2342;
        border-top: 10px solid transparent;
        border-bottom: 10px solid transparent;
      }
      @keyframes popIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .start-panel {
        display: flex;
        gap: 16px;
        align-items: center;
        position: absolute;
        left: 24px;
        bottom: 24px;
      }
      .btn {
        appearance: none;
        border: none;
        cursor: pointer;
        padding: 12px 18px;
        border-radius: 12px;
        background: linear-gradient(180deg, #2a2f55, #1b1f3d);
        color: var(--text);
        font-weight: 700;
        letter-spacing: 0.2px;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12),
          0 8px 20px rgba(0, 0, 0, 0.35);
        transition: transform 0.08s ease, box-shadow 0.2s ease;
      }
      .btn:hover {
        transform: translateY(-1px);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.18),
          0 12px 24px rgba(0, 0, 0, 0.35);
      }
      .btn:active {
        transform: translateY(1px) scale(0.99);
      }
      .btn.primary {
        background: linear-gradient(180deg, #2f9dfd, #1863db);
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.22),
          0 10px 24px rgba(35, 134, 255, 0.35);
      }
      .hint {
        color: var(--muted);
        font-size: 14px;
      }
      .hud {
        display: none;
        margin-top: 18px;
        gap: 12px;
        align-items: center;
        justify-content: space-between;
      }
      .timer {
        flex: 1;
        background: #121431;
        border-radius: 999px;
        height: 14px;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12);
      }
      .timer > i {
        display: block;
        height: 100%;
        width: 100%;
        background: linear-gradient(90deg, var(--accent), #5ef7b8);
        border-radius: inherit;
        transition: width 0.2s linear;
      }
      .status {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      .badge {
        padding: 6px 10px;
        border-radius: 999px;
        background: #1a1d3e;
        border: 1px solid rgba(255, 255, 255, 0.08);
        font-size: 13px;
      }
      .game {
        display: none;
        grid-template-columns: 1.2fr 0.8fr;
        gap: 16px;
        margin-top: 14px;
      }
      .panel {
        background: linear-gradient(180deg, #1d2143, #141632);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 16px 32px rgba(0, 0, 0, 0.35);
      }
      .panel h2 {
        margin: 0 0 10px;
        font-size: 18px;
        color: var(--accent2);
        letter-spacing: 0.2px;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
      }
      .card {
        position: relative;
        background: #202552;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 10px;
        cursor: pointer;
        transition: transform 0.1s ease, box-shadow 0.2s ease, border-color 0.2s;
        min-height: 84px;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.35);
      }
      .card.selected {
        outline: 2px solid var(--accent);
        border-color: transparent;
        box-shadow: 0 0 0 6px rgba(142, 246, 255, 0.12);
      }
      .icon {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background: #121431;
        display: grid;
        place-items: center;
        font-size: 22px;
      }
      .name {
        font-weight: 700;
      }
      .tags {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
        margin-top: 4px;
      }
      .tag {
        font-size: 11px;
        padding: 4px 6px;
        background: #15183a;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 999px;
        color: #c8cff7;
      }
      .stock {
        position: absolute;
        right: 8px;
        bottom: 8px;
        font-size: 11px;
        color: #9aa3dd;
      }
      .plate {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 8px;
        min-height: 88px;
      }
      .chip {
        background: #1b1f46;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 13px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .chip i {
        font-style: normal;
        font-size: 18px;
      }
      .actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
      }
      .synergy-log {
        background: #121431;
        border-radius: 12px;
        padding: 10px;
        height: 140px;
        overflow: auto;
        font-size: 13px;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .synergy-log b {
        color: var(--accent);
      }
      .score {
        font-size: 32px;
        font-weight: 900;
        letter-spacing: 0.4px;
        color: #cbe9ff;
        text-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
      }
      .result {
        display: none;
        margin-top: 16px;
        padding: 16px;
        border-radius: 16px;
        background: #141632;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }
      .result.success {
        border-color: rgba(74, 222, 128, 0.35);
        box-shadow: 0 0 0 6px rgba(74, 222, 128, 0.12) inset;
      }
      .result.fail {
        border-color: rgba(248, 113, 113, 0.35);
        box-shadow: 0 0 0 6px rgba(248, 113, 113, 0.12) inset;
      }
      .result h3 {
        margin: 0 0 6px;
      }
      .plate-anim {
        position: relative;
        height: 120px;
        margin-top: 10px;
      }
      .plate-anim .dish {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 140px;
        height: 140px;
        border-radius: 50%;
        background: radial-gradient(
          circle at 40% 30%,
          #ffffff,
          #d9e8ff 45%,
          #9ab6ff 46%,
          #8aa7ff 48%,
          #313a74 52%,
          #161a3b 53%
        );
        transform: translate(-50%, -50%);
        box-shadow: 0 40px 50px rgba(0, 0, 0, 0.35);
      }
      .spark {
        position: absolute;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--accent2);
        opacity: 0;
      }
      .confetti {
        position: absolute;
        width: 8px;
        height: 14px;
        transform: rotate(15deg);
        opacity: 0;
      }
      .shake {
        animation: shake 0.5s ease;
      }
      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20% {
          transform: translateX(-8px);
        }
        40% {
          transform: translateX(8px);
        }
        60% {
          transform: translateX(-5px);
        }
        80% {
          transform: translateX(5px);
        }
      }
      .footer {
        margin-top: 28px;
        color: var(--muted);
        font-size: 13px;
        text-align: center;
      }
      @media (max-width: 920px) {
        .game {
          grid-template-columns: 1fr;
        }
        .grid {
          grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        .story {
          height: 58dvh;
        }
        .speech {
          right: 180px;
          max-width: 360px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="story" id="story">
        <div class="kitchen-bg"></div>
        <div class="title">ì˜¤ëŠ˜ì˜ ë¯¸ì…˜: <b>ë¯¸ì‹ê°€ë¥¼ ë§Œì¡±ì‹œì¼œë¼!</b></div>
        <div class="chef" aria-label="ì‰í”„">ğŸ‘¨â€ğŸ³</div>
        <div class="critic" aria-label="ë¯¸ì‹ê°€">ğŸ§‘â€âš–ï¸</div>
        <div class="speech">
          <b>ë¯¸ì‹ê°€</b>: "ì†Œë¬¸ì„ ë“£ê³  ì™”ì†Œ. <u>ì œí•œëœ ì‹ì¬ë£Œ</u>ì™€
          <u>í•œì •ëœ ì‹œê°„</u>ìœ¼ë¡œ ë‚˜ë¥¼ ê°ë™ì‹œí‚¬ í•œ ì ‘ì‹œë¥¼ ë³´ì—¬ì£¼ì‹œì˜¤!<br />
          ì ìˆ˜ëŠ” <b>ì‹ì¬ë£Œë“¤ì˜ ì‹œë„ˆì§€</b>ë¡œ í‰ê°€í•˜ê² ì†Œ. ê¸°ì¤€ì ìˆ˜ ì´ìƒì´ë©´ í†µê³¼!"
        </div>
        <div class="start-panel">
          <button class="btn primary" id="startBtn">ê²Œì„ ì‹œì‘</button>
          <span class="hint"
            >ì¬ë£Œ 5ê°œë¥¼ ê³¨ë¼ ìµœê³ ì˜ ì‹œë„ˆì§€ë¥¼ ë§Œë“¤ì. ì œí•œ ì‹œê°„ 60ì´ˆ.</span
          >
        </div>
      </div>

      <div class="hud" id="hud">
        <div class="status">
          <span class="badge"
            >ì˜¤ëŠ˜ì˜ ë¯¸ì‹ê°€ ì·¨í–¥: <b id="palateBadge">â€”</b></span
          >
          <span class="badge">ì„ íƒ: <b id="pickCount">0</b>/5</span>
        </div>
        <div class="timer" aria-label="ë‚¨ì€ ì‹œê°„"><i id="timeBar"></i></div>
      </div>

      <div class="game" id="game">
        <section class="panel">
          <h2>ì‹ë‹¹ ì°½ê³  (í´ë¦­í•˜ì—¬ ë‹´ê¸°)</h2>
          <div class="grid" id="pantry"></div>
        </section>
        <section class="panel">
          <h2>ë‹¹ì‹ ì˜ ì ‘ì‹œ</h2>
          <div class="plate" id="plate"></div>
          <div class="actions">
            <div class="score" id="score">ì ìˆ˜: 0</div>
            <div>
              <button class="btn" id="hintBtn">ì‹œë„ˆì§€ íŒíŠ¸</button>
              <button class="btn primary" id="serveBtn">ë‚´ë†“ê¸°</button>
            </div>
          </div>
          <div class="synergy-log" id="log" aria-live="polite"></div>
        </section>
      </div>

      <div class="result" id="result">
        <h3 id="resultTitle">ê²°ê³¼</h3>
        <div id="resultMsg"></div>
        <div class="plate-anim" id="plateAnim"><div class="dish"></div></div>
        <div style="display: flex; gap: 8px; margin-top: 10px">
          <button class="btn" id="retry">ë‹¤ì‹œ ë„ì „</button>
          <button class="btn" id="showRules">ì‹œë„ˆì§€ ê·œì¹™ ë³´ê¸°</button>
        </div>
      </div>

      <div class="footer">
        Â© 2025 ë¯¸ì‹ê°€ ë ˆì‹œí”¼ ì‹œë„ˆì§€ ê²Œì„ v2 â€” ì¬ë£Œ 5ê°œ ì¡°í•© + ìŒì‹ ì´ë¦„ ìë™
        ìƒì„±
      </div>
    </div>

    <script>
      // --- ë°ì´í„°: ì¬ë£Œì™€ íƒœê·¸ ---
      const INGREDIENTS = [
        {
          id: "beef",
          name: "ì†Œê³ ê¸°",
          icon: "ğŸ¥©",
          stock: 2,
          tags: ["ë‹¨ë°±ì§ˆ", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "pork",
          name: "ë¼ì§€ê³ ê¸°",
          icon: "ğŸ–",
          stock: 2,
          tags: ["ë‹¨ë°±ì§ˆ", "ì§„í•œ"],
        },
        {
          id: "chicken",
          name: "ë‹­ê³ ê¸°",
          icon: "ğŸ—",
          stock: 2,
          tags: ["ë‹¨ë°±ì§ˆ", "ë‹´ë°±"],
        },
        {
          id: "fish",
          name: "í°ì‚´ìƒì„ ",
          icon: "ğŸŸ",
          stock: 2,
          tags: ["ë‹¨ë°±ì§ˆ", "ì‹ ì„ "],
        },
        {
          id: "shrimp",
          name: "ìƒˆìš°",
          icon: "ğŸ¦",
          stock: 2,
          tags: ["ë‹¨ë°±ì§ˆ", "ë°”ë‹¤", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "tofu",
          name: "ë‘ë¶€",
          icon: "ğŸ§Š",
          stock: 3,
          tags: ["ì‹ë¬¼ì„±", "ë‹´ë°±"],
        },
        {
          id: "tomato",
          name: "í† ë§ˆí† ",
          icon: "ğŸ…",
          stock: 3,
          tags: ["ì‚°ë¯¸", "ê°ì¹ ", "ì‹ ì„ "],
        },
        {
          id: "basil",
          name: "ë°”ì§ˆ",
          icon: "ğŸŒ¿",
          stock: 2,
          tags: ["í—ˆë¸Œ", "í–¥"],
        },
        {
          id: "garlic",
          name: "ë§ˆëŠ˜",
          icon: "ğŸ§„",
          stock: 3,
          tags: ["í–¥", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "onion",
          name: "ì–‘íŒŒ",
          icon: "ğŸ§…",
          stock: 3,
          tags: ["í–¥", "ë‹¨ë§›"],
        },
        {
          id: "chili",
          name: "ê³ ì¶”",
          icon: "ğŸŒ¶ï¸",
          stock: 3,
          tags: ["ë§¤ìš´", "í–¥"],
        },
        {
          id: "ginger",
          name: "ìƒê°•",
          icon: "ğŸ«š",
          stock: 2,
          tags: ["í–¥", "ë”°ëœ»"],
        },
        {
          id: "miso",
          name: "ëœì¥",
          icon: "ğŸ«˜",
          stock: 2,
          tags: ["ë°œíš¨", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "soy",
          name: "ê°„ì¥",
          icon: "ğŸ¥£",
          stock: 2,
          tags: ["ë°œíš¨", "ì§ ë§›", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "butter",
          name: "ë²„í„°",
          icon: "ğŸ§ˆ",
          stock: 2,
          tags: ["ì§€ë°©", "ê³ ì†Œ"],
        },
        {
          id: "cream",
          name: "ìƒí¬ë¦¼",
          icon: "ğŸ¥›",
          stock: 2,
          tags: ["ì§€ë°©", "ë¶€ë“œëŸ¬ì›€"],
        },
        {
          id: "lemon",
          name: "ë ˆëª¬",
          icon: "ğŸ‹",
          stock: 2,
          tags: ["ì‚°ë¯¸", "ìƒí¼"],
        },
        {
          id: "rice",
          name: "ìŒ€",
          icon: "ğŸš",
          stock: 3,
          tags: ["íƒ„ìˆ˜", "ë‹´ë°±"],
        },
        {
          id: "pasta",
          name: "íŒŒìŠ¤íƒ€",
          icon: "ğŸ",
          stock: 2,
          tags: ["íƒ„ìˆ˜", "ë‹´ë°±"],
        },
        {
          id: "potato",
          name: "ê°ì",
          icon: "ğŸ¥”",
          stock: 2,
          tags: ["íƒ„ìˆ˜", "í¬ë§Œ"],
        },
        {
          id: "olive",
          name: "ì˜¬ë¦¬ë¸Œì˜¤ì¼",
          icon: "ğŸ«’",
          stock: 2,
          tags: ["ì§€ë°©", "í–¥"],
        },
        {
          id: "cheese",
          name: "ì¹˜ì¦ˆ",
          icon: "ğŸ§€",
          stock: 2,
          tags: ["ì§€ë°©", "ìš°ë§ˆë¯¸"],
        },
        {
          id: "mush",
          name: "ë²„ì„¯",
          icon: "ğŸ„",
          stock: 3,
          tags: ["ìš°ë§ˆë¯¸", "ìˆ²í–¥"],
        },
        {
          id: "seaweed",
          name: "ê¹€",
          icon: "ğŸŸ©",
          stock: 2,
          tags: ["ë°”ë‹¤", "ìš°ë§ˆë¯¸"],
        },
      ];

      // ë¯¸ì‹ê°€ ì·¨í–¥ (ê°€ì¤‘ì¹˜)
      const PALATES = [
        {
          id: "spicy",
          name: "ë§¤ìš´ë§›",
          likes: ["ë§¤ìš´", "í–¥"],
          hates: ["ë¶€ë“œëŸ¬ì›€"],
        },
        {
          id: "umami",
          name: "ìš°ë§ˆë¯¸",
          likes: ["ìš°ë§ˆë¯¸", "ë°œíš¨"],
          hates: ["ìƒí¼"],
        },
        {
          id: "fresh",
          name: "ìƒí¼/ì‹ ì„ ",
          likes: ["ì‹ ì„ ", "ì‚°ë¯¸", "ìƒí¼"],
          hates: ["ì§„í•œ"],
        },
        {
          id: "rich",
          name: "ì§„í•˜ê³  ê³ ì†Œ",
          likes: ["ì§€ë°©", "ê³ ì†Œ"],
          hates: ["ìƒí¼"],
        },
      ];

      // ì‹œë„ˆì§€ ê·œì¹™
      const SYNERGY = {
        pairs: {
          "í† ë§ˆí† +ë°”ì§ˆ": 9,
          "í† ë§ˆí† +ì˜¬ë¦¬ë¸Œì˜¤ì¼": 7,
          "ë§ˆëŠ˜+ì˜¬ë¦¬ë¸Œì˜¤ì¼": 6,
          "ë²„ì„¯+ë²„í„°": 8,
          "ì†Œê³ ê¸°+ë²„í„°": 6,
          "í°ì‚´ìƒì„ +ë ˆëª¬": 8,
          "ìƒˆìš°+ë§ˆëŠ˜": 7,
          "ê°„ì¥+ë²„í„°": 7,
          "ëœì¥+ë§ˆëŠ˜": 6,
          "ì¹˜ì¦ˆ+íŒŒìŠ¤íƒ€": 8,
          "ìŒ€+ê¹€": 6,
          "ê°ì+ë²„í„°": 7,
          "ì–‘íŒŒ+ë²„í„°": 5,
        },
        trios: {
          "í† ë§ˆí† +ë°”ì§ˆ+ì˜¬ë¦¬ë¸Œì˜¤ì¼": 14,
          "ë²„ì„¯+ë²„í„°+ë§ˆëŠ˜": 12,
          "ê°„ì¥+ë²„í„°+ë§ˆëŠ˜": 12,
          "í°ì‚´ìƒì„ +ë ˆëª¬+ë²„í„°": 13,
          "ì¹˜ì¦ˆ+íŒŒìŠ¤íƒ€+ë§ˆëŠ˜": 12,
        },
      };

      const BASE_POINTS = 5; // ê° ì¬ë£Œ ê¸°ë³¸ì ìˆ˜
      const MAX_PICK = 5; // âœ… ë‹¤ì„¯ ê°œ ì¡°í•©
      const TIME_LIMIT = 60; // seconds

      // --- ìƒíƒœ ---
      let pantryState = JSON.parse(JSON.stringify(INGREDIENTS));
      let plate = [];
      let timeLeft = TIME_LIMIT;
      let timer;
      let palate; // ì˜¤ëŠ˜ì˜ ì·¨í–¥
      let threshold = 46; // í†µê³¼ ê¸°ì¤€ (ë™ì )

      // --- ì´ˆê¸°í™” & ìŠ¤í† ë¦¬ì—ì„œ ê²Œì„ìœ¼ë¡œ ---
      const startBtn = document.getElementById("startBtn");
      const storyEl = document.getElementById("story");
      const hud = document.getElementById("hud");
      const game = document.getElementById("game");
      const pantryEl = document.getElementById("pantry");
      const plateEl = document.getElementById("plate");
      const logEl = document.getElementById("log");
      const scoreEl = document.getElementById("score");
      const serveBtn = document.getElementById("serveBtn");
      const hintBtn = document.getElementById("hintBtn");
      const timeBar = document.getElementById("timeBar");
      const pickCount = document.getElementById("pickCount");
      const palateBadge = document.getElementById("palateBadge");
      const resultEl = document.getElementById("result");
      const resultTitle = document.getElementById("resultTitle");
      const resultMsg = document.getElementById("resultMsg");
      const retryBtn = document.getElementById("retry");
      const showRulesBtn = document.getElementById("showRules");

      function setup() {
        // ëœë¤ ì·¨í–¥
        palate = PALATES[Math.floor(Math.random() * PALATES.length)];
        palateBadge.textContent = palate.name;
        // ê¸°ì¤€ì ìˆ˜(ì·¨í–¥ì— ë”°ë¼ ì•½ê°„ ë³€ë™)
        threshold = 46 + Math.floor(Math.random() * 9); // 46~54 (5í”½ ê¸°ì¤€)

        // ê·¸ë¦¬ë“œ ê·¸ë¦¬ê¸°
        renderPantry();
        renderPlate();
        updateScore();
        logEl.innerHTML = "ì‹œë„ˆì§€ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. ğŸ§ª";

        // íƒ€ì´ë¨¸ ì‹œì‘
        timeLeft = TIME_LIMIT;
        updateTimeBar();
        timer = setInterval(() => {
          timeLeft--;
          updateTimeBar();
          if (timeLeft <= 0) {
            clearInterval(timer);
            serve();
          }
        }, 1000);
      }

      function updateTimeBar() {
        const pct = Math.max(0, Math.min(100, (timeLeft / TIME_LIMIT) * 100));
        timeBar.style.width = pct + "%";
        timeBar.style.background =
          pct < 30
            ? `linear-gradient(90deg, var(--bad), #ff9a8a)`
            : `linear-gradient(90deg, var(--accent), #5ef7b8)`;
      }

      startBtn.addEventListener("click", () => {
        storyEl.classList.add("fadeOut");
        storyEl.style.transition = "transform .6s ease, opacity .6s ease";
        storyEl.style.opacity = "0";
        storyEl.style.transform = "translateY(-8px) scale(.99)";
        setTimeout(() => {
          storyEl.style.display = "none";
          hud.style.display = "flex";
          game.style.display = "grid";
          setup();
        }, 620);
      });

      // --- ë Œë”ë§ ---
      function renderPantry() {
        pantryEl.innerHTML = "";
        pantryState.forEach((ing) => {
          const el = document.createElement("button");
          el.className = "card";
          el.setAttribute("type", "button");
          el.dataset.id = ing.id;
          el.innerHTML = `
      <div class="icon">${ing.icon}</div>
      <div>
        <div class="name">${ing.name}</div>
        <div class="tags">${ing.tags
          .map((t) => `<span class="tag">${t}</span>`)
          .join("")}</div>
      </div>
      <div class="stock">ì¬ê³ : ${ing.stock}</div>
    `;
          if (ing.stock <= 0) {
            el.style.opacity = ".45";
            el.style.pointerEvents = "none";
          }
          el.addEventListener("click", () => pick(ing.id));
          pantryEl.appendChild(el);
        });
      }

      function renderPlate() {
        plateEl.innerHTML = "";
        plate.forEach((it) => {
          const el = document.createElement("div");
          el.className = "chip";
          el.innerHTML = `<i>${it.icon}</i>${it.name}`;
          plateEl.appendChild(el);
        });
        pickCount.textContent = plate.length + "";
      }

      // --- ì„ íƒ ë¡œì§ ---
      function pick(id) {
        if (plate.length >= MAX_PICK) {
          bounce(hud);
          return;
        }
        const ing = pantryState.find((x) => x.id === id);
        if (!ing || ing.stock <= 0) return;
        ing.stock--;
        plate.push(ing);
        renderPantry();
        renderPlate();
        updateScore(true);
      }

      // --- ì ìˆ˜ ê³„ì‚° ---
      function updateScore(log = false) {
        const names = plate.map((p) => p.name);
        let score = plate.length * BASE_POINTS; // ê¸°ë³¸ ì ìˆ˜
        let notes = [];

        // íƒœê·¸ ê¸°ë°˜ ê°€ì¤‘ì¹˜ (ì·¨í–¥)
        plate.forEach((p) => {
          p.tags.forEach((t) => {
            if (palate.likes.includes(t)) score += 3;
            if (palate.hates.includes(t)) score -= 2;
          });
        });

        // í˜ì–´ ì‹œë„ˆì§€
        for (let i = 0; i < names.length; i++) {
          for (let j = i + 1; j < names.length; j++) {
            const pair1 = `${names[i]}+${names[j]}`;
            const pair2 = `${names[j]}+${names[i]}`;
            const val = SYNERGY.pairs[pair1] ?? SYNERGY.pairs[pair2];
            if (val) {
              score += val;
              if (log)
                notes.push(
                  `<b>í˜ì–´</b> ${pair1.replace("+", " + ")} = +${val}`
                );
            }
          }
        }
        // íŠ¸ë¦¬ì˜¤ ì‹œë„ˆì§€
        if (names.length >= 3) {
          const combos = combosOf(names, 3);
          combos.forEach((c) => {
            const key = c.join("+");
            if (SYNERGY.trios[key]) {
              score += SYNERGY.trios[key];
              if (log)
                notes.push(
                  `<b>íŠ¸ë¦¬ì˜¤</b> ${c.join(" + ")} = +${SYNERGY.trios[key]}`
                );
            }
          });
        }

        // ë‹¤ì–‘ì„± ë³´ë„ˆìŠ¤
        const uniqueTags = new Set(plate.flatMap((p) => p.tags));
        score += Math.max(0, uniqueTags.size - 3);

        // ë„ˆë¬´ ë¬´ê±°ìš´ ë§› íŒ¨ë„í‹°
        const fat = plate.filter((p) => p.tags.includes("ì§€ë°©")).length;
        const prot = plate.filter(
          (p) => p.tags.includes("ë‹¨ë°±ì§ˆ") || p.tags.includes("ì‹ë¬¼ì„±")
        ).length;
        if (fat >= 2 && prot >= 2) score -= 4;

        scoreEl.textContent = `ì ìˆ˜: ${score}`;
        if (log) {
          logEl.innerHTML = notes.length
            ? notes.map((n) => `â€¢ ${n}`).join("<br>")
            : "ì•„ì§ ì‹œë„ˆì§€ê°€ ì¶©ë¶„í•˜ì§€ ì•Šì•„ìš”. ì¡°í•©ì„ ë…¸ë ¤ë³´ì„¸ìš”!";
        }
        return score;
      }

      function combosOf(arr, k) {
        const res = [];
        (function dfs(start, path) {
          if (path.length === k) {
            res.push([...path]);
            return;
          }
          for (let i = start; i < arr.length; i++) {
            path.push(arr[i]);
            dfs(i + 1, path);
            path.pop();
          }
        })(0, []);
        return res;
      }

      // --- ì•¡ì…˜ ---
      function generateDishName(plate, palate) {
        const has = (n) => plate.some((p) => p.name === n);
        const tag = (t) => plate.some((p) => p.tags.includes(t));
        if (has("í† ë§ˆí† ") && has("ë°”ì§ˆ") && has("ì˜¬ë¦¬ë¸Œì˜¤ì¼")) {
          if (has("íŒŒìŠ¤íƒ€")) return "ì¹´í”„ë ˆì œ íŒŒìŠ¤íƒ€";
          return "ì¹´í”„ë ˆì œ ìŠ¤íƒ€ì¼ ìƒëŸ¬ë“œ";
        }
        if (has("ë²„ì„¯") && has("ë²„í„°") && has("ë§ˆëŠ˜")) {
          if (has("ìŒ€")) return "ê°ˆë¦­ë²„í„° ë¨¸ì‰¬ë£¸ ë¦¬ì†Œí† ";
          return "ê°ˆë¦­ë²„í„° ë¨¸ì‰¬ë£¸ ì†Œí…Œ";
        }
        if (has("í°ì‚´ìƒì„ ") && has("ë ˆëª¬") && has("ë²„í„°"))
          return "ë ˆëª¬ë²„í„° í™”ì´íŠ¸í”¼ì‹œ";
        if (has("ê°„ì¥") && has("ë²„í„°") && has("ë§ˆëŠ˜")) {
          if (has("ìŒ€")) return "ê°“ë²„ë§ˆ ë²„í„°ê°„ì¥ ë®ë°¥";
          return "ë²„í„°ê°„ì¥ ê°ˆë¦­ ê¸€ë ˆì´ì¦ˆ";
        }
        if (has("ì¹˜ì¦ˆ") && has("íŒŒìŠ¤íƒ€")) {
          if (has("ë§ˆëŠ˜")) return "ì¹˜ì¦ˆ ì•Œë¦¬ì˜¤ íŒŒìŠ¤íƒ€";
          return "í¬ë¥´ë§ˆì§€ì˜¤ íŒŒìŠ¤íƒ€";
        }
        if (has("ìƒˆìš°") && has("ë§ˆëŠ˜") && has("íŒŒìŠ¤íƒ€"))
          return "ê°ë² ë¦¬ ì•„ê¸€ë¦¬ì˜¤ ì˜¬ë¦¬ì˜¤";
        if (has("ì†Œê³ ê¸°") && has("ë²„í„°") && has("ê°ì"))
          return "ë²„í„° ìŠ¤í…Œì´í¬ & ë§¤ì‰¬";
        if (has("ìŒ€") && has("ê¹€")) return "ìš°ë§ˆë¯¸ ê¹€ë®ë°¥";
        const base = [
          tag("ë°”ë‹¤") ? "ì˜¤ì…˜" : "ì…°í”„",
          tag("ì§€ë°©") ? "ë¦¬ì¹˜" : "ë¼ì´íŠ¸",
          tag("ì‚°ë¯¸") ? "ì‹œíŠ¸ëŸ¬ìŠ¤" : "í•˜ëª¨ë‹ˆ",
        ];
        let name = base.filter(Boolean).slice(0, 2).join(" ");
        const cat = has("íŒŒìŠ¤íƒ€")
          ? "íŒŒìŠ¤íƒ€"
          : has("ìŒ€")
          ? "ë¼ì´ìŠ¤"
          : has("ì†Œê³ ê¸°")
          ? "ìŠ¤í…Œì´í¬"
          : has("í°ì‚´ìƒì„ ")
          ? "í”¼ì‹œ"
          : "í”Œë ˆì´íŠ¸";
        if (!name) name = palate.name;
        return `${name} ${cat}`;
      }

      serveBtn.addEventListener("click", serve);
      function serve() {
        clearInterval(timer);
        const score = updateScore(false);
        const ok = score >= threshold;
        const dishName = generateDishName(plate, palate);
        resultEl.style.display = "block";
        resultEl.className = "result " + (ok ? "success" : "fail");
        resultTitle.textContent = ok
          ? `í†µê³¼! ${dishName} âœ¨`
          : `ì•„ì‰½ìŠµë‹ˆë‹¤â€¦ ${dishName}`;
        resultMsg.innerHTML = `ìµœì¢… ì ìˆ˜ <b>${score}</b> / ê¸°ì¤€ì ìˆ˜ <b>${threshold}</b> â€” ì·¨í–¥: <b>${palate.name}</b>`;
        animatePlate(ok);
      }

      retryBtn.addEventListener("click", () => {
        pantryState = JSON.parse(JSON.stringify(INGREDIENTS));
        plate = [];
        resultEl.style.display = "none";
        hud.classList.remove("shake");
        hud.style.display = "flex";
        game.style.display = "grid";
        setup();
      });

      hintBtn.addEventListener("click", () => {
        const tips = [
          "ì´íƒˆë¦¬ì•ˆ í–¥: í† ë§ˆí†  + ë°”ì§ˆ + ì˜¬ë¦¬ë¸Œì˜¤ì¼",
          "ë²„ì„¯ í’ë¯¸: ë²„ì„¯ + ë²„í„° (+ ë§ˆëŠ˜)",
          "í•´ì‚°ë¬¼ ê¸°ë³¸: í°ì‚´ìƒì„  + ë ˆëª¬ (+ ë²„í„°)",
          "ê°ì¹  í­íƒ„: ê°„ì¥ + ë²„í„° + ë§ˆëŠ˜",
          "ë“ ë“ í•œ ë©”ì¸: ì¹˜ì¦ˆ + íŒŒìŠ¤íƒ€ (+ ë§ˆëŠ˜)",
        ];
        logEl.innerHTML = "ğŸ’¡ " + tips[Math.floor(Math.random() * tips.length)];
      });

      function bounce(el) {
        el.classList.add("shake");
        setTimeout(() => el.classList.remove("shake"), 520);
      }

      // --- ì—°ì¶œ ---
      function animatePlate(success) {
        const area = document.getElementById("plateAnim");
        area.innerHTML = '<div class="dish"></div>';
        if (success) {
          confetti(area, 36);
        } else {
          spark(area, 14);
        }
      }
      function spark(area, n) {
        for (let i = 0; i < n; i++) {
          const s = document.createElement("div");
          s.className = "spark";
          const x = 60 + Math.random() * 80;
          const y = 20 + Math.random() * 80;
          s.style.left = x + "px";
          s.style.top = y + "px";
          s.style.opacity = 0;
          area.appendChild(s);
          const delay = i * 20;
          setTimeout(() => {
            s.animate(
              [
                { transform: "translate(70px,60px) scale(.4)", opacity: 0 },
                {
                  transform: `translate(${Math.random() * 160 - 80}px, ${
                    Math.random() * 60 - 30
                  }px) scale(1.2)`,
                  opacity: 1,
                  offset: 0.4,
                },
                {
                  transform: `translate(${Math.random() * 220 - 110}px, ${
                    Math.random() * 120 - 60
                  }px) scale(.6)`,
                  opacity: 0,
                },
              ],
              {
                duration: 700 + Math.random() * 400,
                easing: "ease-out",
                fill: "forwards",
              }
            );
          }, delay);
        }
      }
      function confetti(area, n) {
        for (let i = 0; i < n; i++) {
          const c = document.createElement("div");
          c.className = "confetti";
          c.style.background = `hsl(${Math.floor(
            Math.random() * 360
          )}, 90%, 60%)`;
          c.style.left = 60 + Math.random() * 80 + "px";
          c.style.top = 40 + Math.random() * 20 + "px";
          c.style.opacity = 0.9;
          area.appendChild(c);
          const dx = (Math.random() * 2 - 1) * 140;
          const dy = 160 + Math.random() * 80;
          c.animate(
            [
              { transform: "translate(0,0) rotate(0deg)", opacity: 1 },
              {
                transform: `translate(${dx / 2}px, ${dy / 2}px) rotate(180deg)`,
                opacity: 0.9,
              },
              {
                transform: `translate(${dx}px, ${dy}px) rotate(360deg)`,
                opacity: 0,
              },
            ],
            {
              duration: 1200 + Math.random() * 600,
              easing: "cubic-bezier(.22,.61,.36,1)",
            }
          );
        }
      }

      // --- ê·œì¹™ ë³´ê¸° ---
      showRulesBtn.addEventListener("click", () => {
        const pairList = Object.entries(SYNERGY.pairs)
          .map(([k, v]) => `â€¢ ${k.replace("+", " + ")} = +${v}`)
          .join("\n");
        const trioList = Object.entries(SYNERGY.trios)
          .map(([k, v]) => `â€¢ ${k.replaceAll("+", " + ")} = +${v}`)
          .join("\n");
        alert(
          `[ì‹œë„ˆì§€ ê·œì¹™]
- ê° ì¬ë£Œ ê¸°ë³¸ì ìˆ˜: ${BASE_POINTS}
- ì·¨í–¥ ë³´ë„ˆìŠ¤: ë¯¸ì‹ê°€ê°€ ì¢‹ì•„í•˜ëŠ” íƒœê·¸ +3, ì‹«ì–´í•˜ëŠ” íƒœê·¸ -2
- í˜ì–´/íŠ¸ë¦¬ì˜¤: ì•„ë˜ ì¡°í•© ë³´ë„ˆìŠ¤ ì ìš©
\n[í˜ì–´]\n${pairList}\n\n[íŠ¸ë¦¬ì˜¤]\n${trioList}\n\në³´ë„ˆìŠ¤: íƒœê·¸ ë‹¤ì–‘ì„± + (ê³ ê¸°+ì§€ë°© ê³¼í•˜ë©´ -4)\n- ìµœëŒ€ ì„ íƒ: ${MAX_PICK}`
        );
      });
    </script>
  </body>
</html>
